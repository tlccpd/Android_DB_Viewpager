package com.trwth.member;

import java.util.ArrayList;

import android.app.Activity;
import android.content.Context;
import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.Bundle;
import android.view.LayoutInflater;
import android.view.View;
import android.view.ViewGroup;
import android.widget.ArrayAdapter;
import android.widget.ImageView;
import android.widget.ListView;
import android.widget.TextView;

public class ListMain extends Activity {

	private ListView listview;  
	 // 데이터를 연결할 Adapter
	 DataAdapter adapter;
	 // 데이터를 담을 자료구조
	 ArrayList<Data> alist;  //
	 DbAdapter dba;
	 
	
	 //String[] item;
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		super.onCreate(savedInstanceState);
		setContentView(R.layout.list_main);
		
		Intent intent = getIntent();
		
		dba=new DbAdapter(this);
		dba.open();
		
		//item = intent.getStringArrayExtra("item");
		listview = (ListView) findViewById(R.id.list);  
		alist = dba.fetchAllMembers();
		
		adapter = new DataAdapter(getBaseContext(), android.R.layout.simple_list_item_2, alist);
		listview.setAdapter(adapter);		
	}	
	
	public class DataAdapter extends ArrayAdapter<Data>{

		private LayoutInflater mInflater;
		private Bitmap bmp;
		
		public DataAdapter(Context context, int resource, ArrayList<Data> objects) {
			super(context, 0,objects);
			// TODO Auto-generated constructor stub
			 mInflater = (LayoutInflater) context.getSystemService(Context.LAYOUT_INFLATER_SERVICE);
		}
		@Override
		public View getView(int position, View v, ViewGroup parent) {
			// TODO Auto-generated method stub
			
			if (v == null)	    
			   v = mInflater.inflate(R.layout.list, null);
		   
		   final Data datum = this.getItem(position);
		   
		   if(datum!=null){
			   TextView name=(TextView)v.findViewById(R.id.tv1);
			   TextView age= (TextView)v.findViewById(R.id.tv2);
			   TextView gender= (TextView)v.findViewById(R.id.tv3);
			   			   
			   name.setText(datum.getName());
			   age.setText(datum.getAge());
			   gender.setText(datum.getGender());
			 if(datum.getPath()!=null){			   
			   ImageView image=(ImageView)v.findViewById(R.id.image);
			   bmp= BitmapFactory.decodeFile(datum.getPath().substring(7));
			   image.setImageBitmap(bmp);			   
			 }
		   }
		   
		   
		   return v;	   
		}
	}
}
